<!DOCTYPE html>
<html lang="en-NZ">

<head>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
	<meta charset="utf-8" />

	<link rel="shortcut icon" href="/logo.svg" />
	<title>Downloads â†’ {{ app.name }} {{ meta.version }}</title>
	<meta name="description"
		content="A suite of tools and libraries related to Watchexec, which runs commands when files change. Download page for official binaries for {{ app.name }} {{ meta.version }}." />

	<link rel="stylesheet" href="/style.css" />
</head>

<body>
	<section>
		<h2>{{ app.name }} {{ meta.version }}</h2>

		<aside>
			<h3>Changes</h3>

			TODO
		</aside>

		<table class="downloads">
			<thead>
				<tr>
					<th>OS</th>
					<th>Arch</th>
					<th>Variant</th>
					<th>Download</th>
					<th>BLAKE3 checksum</th>
				</tr>
			</thead>
			<tbody>
				{%- for os, dls1 in meta.downloads | group_by(attribute='cats.0') -%}
					{%- set len1 = dls1 | length -%}
					{%- for arch, dls2 in dls1 | group_by(attribute='cats.1') -%}
						{%- set first2 = loop.first -%}
						{%- set len2 = dls2 | length -%}
						{%- for variant, dls3 in dls2 | group_by(attribute='cats.2') -%}
							{%- set first3 = loop.first -%}
							{%- set len3 = dls3 | length -%}
							{% for dl in dls3 %}
							<tr>
								{% if first2 and first3 and loop.first %}<td rowspan="{{ len1 }}">{{ os }}</td>{% endif %}
								{% if first3 and loop.first %}<td rowspan="{{ len2 }}">{{ arch }}</td>{% endif %}
								{% if loop.first %}<td rowspan="{{ len3 }}">{{ variant }}</td>{% endif %}
								<td><a class="download" href="{{ dl.url }}">{{ dl.size / 1024 | round }} KB ({{ dl.format.short }})</a></td>
								<td>
									{%- set sum = dl.sums | filter(attribute='algo', value='BLAKE3') | map(attribute='sum') | first -%}
									{%- if sum -%}
										<code class="checksum">{{ sum }}</code>
									{%- else -%}
										<em class="missing-checksum">missing checksum</em>
									{%- endif -%}
								</td>
							</tr>
							{% endfor %}
						{%- endfor -%}
					{%- endfor -%}
				{%- endfor -%}
			</tbody>
		</table>

		<table class="signatures">
			{% for sum in meta.sums %}
			<tr>
				<th><a href="{{ sum.url }}">{{ sum.algo }} checksums</a></th>
				{% for sign in sum.signs %}
				<td>
					<a href="{{ sign.sign_url }}">{{ sign.name }}</a>
					(<a href="{{ sign.key_url }}">key</a>)
				</td>
				{% endfor %}
			</tr>
			{% endfor %}
		</table>
	</section>
</body>

</html>
